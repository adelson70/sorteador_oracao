{% extends 'index.html' %}
{% block conteudo %}

<!-- DIV DE CARREGAMENTO ATÉ OS NOMES SEREM SORTEADOS -->
<div class="carregamento">

    <div class="msg">
        "A oração é a respiração da alma. É o segredo do poder espiritual. Nenhum outro recurso da graça pode substituí-la, e a saúde da alma ser conservada."
        <div class="livro">
            Mensagens aos Jovens - Pag. 249
        </div> 
    </div>

    <div class="container-pessoas">
        <!-- TITULO -->
        <h1 class="titulo-pessoas">Amigos de Oração</h1>

        <!-- CARD COM O NOME DAS PESSOAS QUE ESTÃO PARTICIPANDO -->
        <h2 class="nomesParticipando">Nome 1, Nome 2, Nome 3</h2>
        
        <!-- ANIMAÇÃO DE CARREGAMENTO -->
        <div class="d-flex justify-content-center">
            <div class="spinner-border" role="status" title="Carregando amigo de fé"></div>
        </div>
    </div>
</div>

<!-- MSG QUE IRA APARECER MOSTRANDO O NOME DA PESSOA QUE O USUÁRIO IRA ORAR -->
<div class="pessoaOracao">
    
    <!-- MENSAGEM DE QUEM A PESSOA IRA ORAR -->
     <div class="oracao badge text-bg-info" id="oracao" style="background-color: #f7e7a3 !important;"></div>
    
    <script>
        window.onload =  function(){
            const socket = io('http://192.168.10.28:5000');

            // EVENTO PARA QUANDO RECEBER A MSG DE EMISSÃO 'receber_nome', IRA TRATAR OS DADOS E MOSTRAR APENAS O NECESSARIO PARA O CLIENT
            socket.on('receber_nome', (data) => {
                // REQUISIÇÃO PARA BUSCAR O NOME DA PESSOA DE ORAÇÃO
                dataJSON = JSON.stringify(data)
                axios.get(`pessoaOracao/${dataJSON}`)
                    .then(response=>{
                        // DESEMPACOTANDO AS INFORMAÇÕES
                        var meuNome = response.data.meuNome
                        var pessoaOracao = response.data.pessoaOracao

                        // TIRA DA TELA A INFORMAÇÃO REFERENTE AO CARREGAMENTO
                        eleLoad.style.display = 'none'
                        
                        // MENSAGEM QUE IRA APARECER
                        msg = `<div class="nomePessoaOracao">${pessoaOracao}</div> é seu amigo de oração da semana!`

                        // MENSAGEM PARA DEPURAÇÃO
                        msgConsole = (response.data)
                        console.log(msgConsole)

                        // CAPTURANDO ELEMENTO ONDE MOSTRA A MENSAGEM DA PESSOA DE ORAÇÃO
                        const eleMsgOracao = document.getElementById('oracao')

                        // ATRIBUINDO VALOR AO ELEMENTO
                        eleMsgOracao.innerHTML = msg

                        // MOSTRANDO ALERT
                        alert(`${pessoaOracao} é seu amigo de oração da semana!`)
                    })
            })
        }
    </script>
</div>
                    
<!-- CASO O USUARIO JÁ TENHA CADASTRADO SEU NOME E TENHA ATUALIZADO A PAGINA -->
 <!-- FICARA CARREGANDO ATÉ RECEBER O NOME DE ORAÇÃO -->
{% if nomeCadastrado == True %}
<script>
    // DEIXA A DIV ONDE CONTEM AS INFORMAÇÕES DE PESSOAS PARTICIPANDO E LOAD VISIVEL
    const eleContainerPessoas = document.getElementsByClassName('container-pessoas')[0]
    eleContainerPessoas.style.display = 'block'
</script>

<!-- CASO SEJA O PRIMEIRO ACESSO DO USUARIO A PAGINA E ELE NÃO TENHA AINDA CADASTRADO SEU NOME -->
{% else %}
<div class="caixa-entrada">
    <label class="titulo-input" for="nomeOracao">Digite seu nome</label>

    <input class="nomeOracao" text id="nomeOracao">

    <div class="d-flex justify-content-center">
        <button class="btn btn-success btn-add-nome" id="adicionarNome">Adicionar</button>
    </div>
</div>
{% endif %}

{% endblock conteudo %}